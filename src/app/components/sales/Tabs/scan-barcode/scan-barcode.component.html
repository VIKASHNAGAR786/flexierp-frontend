<h3 class="text-xl font-extrabold mb-4 uppercase tracking-wide drop-shadow-md"
  style="color: var(--heading)">
  Scan / Enter Barcode
</h3>

<!-- Barcode + Button Row -->
<div class="flex items-end gap-4 mb-4">

  <!-- Barcode Input -->
  <div class="flex-1 flex flex-col">
    <label class="mb-2 text-sm md:text-base font-extrabold uppercase tracking-wide drop-shadow-md"
      style="color: var(--heading)">
      Barcode
    </label>
    <input type="text"
      placeholder="Scan or Enter Barcode"
      [(ngModel)]="saleProduct.barcode"
      name="barcode"
      (keyup.enter)="onEnterBarcode()"
      class="w-full px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200"
           style="background: var(--input-bg);
                  color: var(--input-text);
                  border: 1px solid var(--input-border);
                  ">
    </div>

    <!-- Product List Button -->
    <button type="button"
      (click)="showProductList = true"
      class="font-bold px-4 py-2 rounded-lg shadow-md transition"
          style="background: var(--accent-1);
                 color: var(--sidebar-hover-text);
                 border: 1px solid var(--card-border)">
      Product List
    </button>

    <!-- Product List Popup -->
    <app-productlistpopup
      [showProductList]="showProductList"
      [products]="products"
      (close)="showProductList = false"
      (selectProduct)="onProductSelected($event)">
    </app-productlistpopup>
  </div>

  <!-- Open/Close Scanner Button -->
  <div class="flex gap-2 mb-4">
    <button type="button"
      (click)="toggleScanner()"
      class="px-6 py-2 rounded font-bold transition"
          style="background: var(--accent-1);
                 color: var(--sidebar-hover-text)">
      {{ scannerEnabled ? 'Close Camera' : 'Open Camera Scanner' }}
    </button>

    @if (scannerEnabled && torchAvailable) {
      <button
        type="button"
        (click)="toggleTorch()"
        class="px-4 py-2 rounded font-bold transition"
          style="background: var(--particle-2);
                 color: var(--sidebar-hover-text)">
        {{ torchEnabled ? 'Torch OFF' : 'Torch ON' }}
      </button>
    }
  </div>

  <!-- Camera Selection & Scanner -->
  @if (scannerEnabled) {
    <div class="space-y-2">
      <!-- Camera Selector Dropdown -->
      <select (change)="onDeviceSelectChange($event)"
        class="w-full px-3 py-2 rounded-md focus:outline-none"
          style="background: var(--input-bg);
                 color: var(--input-text);
                 border: 1px solid var(--input-border)">
        @for (device of availableDevices; track device) {
          <option [value]="device.deviceId">
            {{ device.label || 'Unknown Device' }}
          </option>
        }
      </select>
      <!-- ZXing Scanner with overlay -->
      <div class="relative w-full h-80 rounded-lg overflow-hidden shadow-lg"
        style="border: 1px solid var(--card-border)">
        <zxing-scanner [device]="selectedDevice"
          [formats]="formats"
          [tryHarder]="true"
          [autofocusEnabled]="true"
          [torch]="torchEnabled"
          [videoConstraints]="constraints"
          (camerasFound)="availableDevices = $event"
          (scanSuccess)="onCodeResult($event)"
          class="w-full h-full">
        </zxing-scanner>
        <!-- Overlay -->
        <div class="absolute inset-0 pointer-events-none"
        style="background: var(--modal-overlay)"></div>
        <!-- Scanner ROI Box -->
        <div class="absolute top-1/2 left-1/2 w-3/5 h-1/3 transform -translate-x-1/2 -translate-y-1/2 rounded-lg"
          style="border: 4px solid var(--accent-1)">
          <!-- Scanning Line -->
          <div class="absolute top-0 left-0 w-full h-1 animate-scan"
          style="background: var(--accent-1)"></div>
        </div>
      </div>
    </div>
  }