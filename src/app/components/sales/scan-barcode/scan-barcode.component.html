<h3 class="text-xl font-extrabold text-[#00ffee] mb-4 uppercase tracking-wide drop-shadow-md">
  Scan / Enter Barcode
</h3>

<!-- Barcode + Button Row -->
<div class="flex items-end gap-4 mb-4">

  <!-- Barcode Input -->
  <div class="flex-1 flex flex-col">
    <label class="mb-2 text-sm md:text-base font-extrabold text-[#00ffee] uppercase tracking-wide drop-shadow-md">
      Barcode
    </label>
    <input type="text" placeholder="Scan or Enter Barcode" [(ngModel)]="saleProduct.barcode" name="barcode"
      (keyup.enter)="onEnterBarcode()" class="w-full px-4 py-2 text-gray-900 dark:text-white bg-white dark:bg-slate-800 border 
             border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 
             focus:ring-green-500 focus:border-green-500 transition-all duration-200" />
  </div>

  <!-- Product List Button -->
  <button type="button" (click)="showProductList = true"
    class="bg-[#00ffee] text-slate-900 font-bold px-4 py-2 rounded-lg shadow-md hover:bg-[#00ccbb] transition">
    Product List
  </button>

  <!-- Product List Popup -->
 <app-productlistpopup
  [showProductList]="showProductList"
  [products]="products" 
  (close)="showProductList = false"
  (selectProduct)="onProductSelected($event)">
</app-productlistpopup>
</div>

<!-- Open/Close Scanner Button -->
<div class="flex gap-2 mb-4">
  <button type="button" (click)="toggleScanner()"
    class="bg-[#00ffee] text-black px-6 py-2 rounded font-bold hover:bg-white transition">
    {{ scannerEnabled ? 'Close Camera' : 'Open Camera Scanner' }}
  </button>
  <button *ngIf="scannerEnabled && torchAvailable" type="button" (click)="toggleTorch()"
    class="bg-yellow-400 text-black px-4 py-2 rounded font-bold hover:bg-yellow-300 transition">
    {{ torchEnabled ? 'Torch OFF' : 'Torch ON' }}
  </button>
</div>

<!-- Camera Selection & Scanner -->
<div *ngIf="scannerEnabled" class="space-y-2">

  <!-- Camera Selector Dropdown -->
  <select (change)="onDeviceSelectChange($event)"
    class="w-full px-3 py-2 rounded-md bg-slate-700 text-white border border-gray-600 focus:outline-none">
    <option *ngFor="let device of availableDevices" [value]="device.deviceId">
      {{ device.label || 'Unknown Device' }}
    </option>
  </select>

  <!-- ZXing Scanner with overlay -->
  <div class="relative w-full h-80 rounded-lg overflow-hidden shadow-lg">
    <zxing-scanner [device]="selectedDevice" [formats]="formats" [tryHarder]="true" [autofocusEnabled]="true"
      [torch]="torchEnabled" [videoConstraints]="constraints" (camerasFound)="availableDevices = $event"
      (scanSuccess)="onCodeResult($event)" class="w-full h-full"></zxing-scanner>

    <!-- Overlay: Dark transparent -->
    <div class="absolute inset-0 bg-black/50 pointer-events-none"></div>

    <!-- Scanner ROI Box -->
    <div
      class="absolute top-1/2 left-1/2 w-3/5 h-1/3 transform -translate-x-1/2 -translate-y-1/2 border-4 border-green-400 rounded-lg">
      <!-- Scanning Line -->
      <div class="absolute top-0 left-0 w-full h-1 bg-green-400 animate-scan"></div>
    </div>
  </div>
</div>