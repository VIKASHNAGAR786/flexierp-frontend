<div class="min-h-screen bg-[var(--card-bg)] text-[var(--text)] font-sans p-6">

  <h2 class="text-2xl font-semibold mb-6 text-[var(--accent)] text-center drop-shadow-md">
    üóíÔ∏è My Notes
  </h2>

  <!-- Add Note Button -->
  <div class="text-center mb-6">
    <button
      (click)="openPopup()"
      class="py-2 px-5 rounded-lg bg-[var(--accent)] text-[var(--accent)]
             font-semibold hover:bg-[var(--accent-hover)] transition shadow-md"
    >
      ‚ûï Add New Note
    </button>
  </div>

  <!-- Notes List -->
  <div *ngIf="allnotes.length > 0; else noNotes">
    <div class="space-y-4 max-h-[500px] overflow-y-auto p-2">

      <div
        *ngFor="let note of allnotes"
        class="bg-[var(--card-bg-secondary)] backdrop-blur-md p-5 rounded-2xl
               shadow-lg border border-[var(--border)]
               hover:border-[var(--accent)] hover:shadow-[0_0_20px_var(--accent-shadow)]
               transition-all duration-300 relative"
      >

        <!-- Header -->
        <div class="flex items-start justify-between mb-3">
          <div>
            <h3 class="text-xl font-semibold text-[var(--accent)] leading-tight mb-1">
              {{ note.title }}
            </h3>
            <p class="text-sm text-[var(--text-muted)]">
              Author:
              <span class="text-[var(--text)]">{{ note.authorId }}</span>
            </p>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-center space-x-2">

            <!-- VIEW -->
            <button
              appTooltip="View Note"
              [tooltipPosition]="'bottom'"
              [tooltipFixed]="false"
              (click)="viewNote(note.id)"
              class="p-2 rounded-lg bg-[var(--input-bg)] hover:bg-[var(--input-bg-hover)]
                     transition text-blue-400"
            >
              <i class="bi bi-eye text-base"></i>
            </button>

            <!-- EDIT -->
            <button
              appTooltip="Edit Note"
              [tooltipPosition]="'bottom'"
              [tooltipFixed]="false"
              (click)="editNote(note.id)"
              class="p-2 rounded-lg bg-[var(--input-bg)] hover:bg-[var(--input-bg-hover)]
                     transition text-green-400"
            >
              <i class="bi bi-pencil-square text-base"></i>
            </button>

            <!-- PIN -->
            <button
              *ngIf="!note.isPinned"
              appTooltip="Pin Note"
              [tooltipPosition]="'bottom'"
              [tooltipFixed]="false"
              (click)="pinNote(note.id)"
              class="p-2 rounded-lg bg-[var(--input-bg)] hover:bg-[var(--input-bg-hover)]
                     transition text-yellow-400"
            >
              <i class="bi bi-pin-angle text-base"></i>
            </button>

            <!-- UNPIN -->
            <button
              *ngIf="note.isPinned"
              appTooltip="Unpin Note"
              [tooltipPosition]="'bottom'"
              [tooltipFixed]="false"
              (click)="pinNote(note.id)"
              class="p-2 rounded-lg bg-[var(--input-bg)] hover:bg-[var(--input-bg-hover)]
                     transition text-red-400"
            >
              <i class="bi bi-pin text-base"></i>
            </button>

            <!-- DELETE -->
            <button
              appTooltip="Delete Note"
              [tooltipPosition]="'bottom'"
              [tooltipFixed]="false"
              (click)="deleteNote(note.id)"
              class="p-2 rounded-lg bg-[var(--input-bg)] hover:bg-[var(--input-bg-hover)]
                     transition text-red-400"
            >
              <i class="bi bi-trash3 text-base"></i>
            </button>

          </div>
        </div>

        <!-- Note Content -->
        <div
          class="text-[var(--text)] leading-relaxed max-w-none"
          [innerHTML]="note.content"
        ></div>

        <!-- Footer -->
        <div
          class="text-xs text-[var(--text-muted)] italic mt-4 border-t
                 border-[var(--border)] pt-2 flex justify-end"
        >
          {{ note.createdAt | date:'medium' }}
        </div>

      </div>

    </div>
  </div>

  <!-- No Notes Template -->
  <ng-template #noNotes>
    <p class="text-[var(--text-muted)] text-center mt-6">
      No notes available. Start by adding one!
    </p>
  </ng-template>

  <!-- Add Note Popup --------------------------------------------------------->
  <div
  *ngIf="showPopup"
  class="fixed inset-0 bg-[var(--overlay)] flex justify-center items-center z-50"
>
  <div class="bg-[var(--card-bg)] p-8 rounded-2xl shadow-2xl w-full max-w-3xl relative border border-[var(--border)]">

    <!-- Close Button -->
    <button
      (click)="closePopup()"
      class="absolute top-4 right-5 text-[var(--text-secondary)] hover:text-[var(--accent)] text-2xl font-bold transition"
    >
      ‚úñ
    </button>

    <h2 class="text-2xl font-semibold mb-6 text-[var(--accent)] text-center drop-shadow-md">
      üìù Create a New Note
    </h2>

    <div class="space-y-6">
      <!-- Title -->
      <div>
        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Note Title *</label>
        <input
          type="text"
          [(ngModel)]="noteTitle"
          placeholder="Enter your note title..."
          class="w-full p-3 rounded-lg bg-[var(--input-bg)] text-[var(--text)] border border-[var(--border)]
                 focus:outline-none focus:ring-2 focus:ring-[var(--accent)] shadow-inner placeholder-[var(--text-secondary)]"
        />
      </div>

      <!-- Toolbar -->
      <div
        class="flex flex-wrap items-center justify-center gap-3 mb-3 bg-[var(--input-bg)] p-3 rounded-lg border border-[var(--border)] shadow-inner"
      >
        <button
          type="button"
          (click)="formatText('bold')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg font-bold"
        >B</button>

        <button
          type="button"
          (click)="formatText('italic')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded italic text-lg"
        >I</button>

        <button
          type="button"
          (click)="formatText('underline')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded underline text-lg"
        >U</button>

        <button
          type="button"
          (click)="formatText('strikeThrough')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg line-through"
        >S</button>

        <div class="w-px h-5 bg-[var(--border)]"></div>

        <button
          type="button"
          (click)="formatText('insertUnorderedList')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg"
        >‚Ä¢ List</button>

        <button
          type="button"
          (click)="formatText('insertOrderedList')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg"
        >1. List</button>

        <div class="w-px h-5 bg-[var(--border)]"></div>

        <button
          type="button"
          (click)="formatText('justifyLeft')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg"
        >‚á§</button>

        <button
          type="button"
          (click)="formatText('justifyCenter')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg"
        >‚ò∞</button>

        <button
          type="button"
          (click)="formatText('justifyRight')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg"
        >‚á•</button>

        <div class="w-px h-5 bg-[var(--border)]"></div>

        <button
          type="button"
          (click)="formatText('undo')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg"
        >‚Ü∂</button>

        <button
          type="button"
          (click)="formatText('redo')"
          class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-light)] rounded text-lg"
        >‚Ü∑</button>
      </div>

      <!-- Editor -->
      <div
        #editor
        id="noteEditor"
        contenteditable="true"
        class="w-full min-h-[250px] p-4 rounded-lg bg-[var(--input-bg)] text-[var(--text)]
               border border-[var(--border)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]
               shadow-inner overflow-y-auto"
        (input)="onNoteInput($event)"
      ></div>

      <!-- Flags -->
      <div class="flex items-center justify-center space-x-8 mt-4">
        <label class="flex items-center space-x-2 text-sm text-[var(--text-secondary)]">
          <input
            type="checkbox"
            [(ngModel)]="notePinned"
            class="h-5 w-5 text-[var(--accent)] bg-[var(--input-bg)] border-[var(--border)] rounded focus:ring-[var(--accent)]"
          />
          <span>Pinned</span>
        </label>

        <label class="flex items-center space-x-2 text-sm text-[var(--text-secondary)]">
          <input
            type="checkbox"
            [(ngModel)]="noteArchived"
            class="h-5 w-5 text-[var(--accent)] bg-[var(--input-bg)] border-[var(--border)] rounded focus:ring-[var(--accent)]"
          />
          <span>Archived</span>
        </label>
      </div>

      <!-- Save -->
      <button
        (click)="addNote()"
        class="w-full py-3 px-4 rounded-lg font-semibold bg-[var(--accent)] text-black hover:bg-[var(--accent-hover)] transition-all shadow-md text-lg"
      >
        üíæ Save Note
      </button>

    </div>
  </div>
</div>


  <!-- View Note Details Popup -->
  <div
  *ngIf="showNoteDetailPopup"
  class="fixed inset-0 bg-[var(--overlay)] flex justify-center items-center z-50"
>
  <div
    class="bg-[var(--card-bg)] p-8 rounded-2xl shadow-2xl w-[90%] max-w-3xl relative 
           border border-[var(--border)] overflow-y-auto max-h-[85vh] text-[var(--text)]"
  >

    <!-- Close Button -->
    <button
      (click)="closeNoteDetailPopup()"
      class="absolute top-4 right-4 text-[var(--text-secondary)] hover:text-[var(--accent)] 
             text-2xl font-bold transition"
    >
      ‚úñ
    </button>

    <!-- Header -->
    <h2 class="text-2xl font-semibold mb-6 text-[var(--accent)] text-center tracking-wide">
      üìù Note Details
    </h2>

    <!-- Note Details -->
    <div *ngIf="selectedNote; else loadingNote" class="space-y-5">

      <div class="p-4 bg-[var(--input-bg)] rounded-lg shadow-inner border border-[var(--border)]">

        <h3 class="text-2xl font-semibold text-[var(--accent)] mb-3">
          Title : {{ selectedNote.title || 'Untitled Note' }}
        </h3>

        <div
          class="text-base text-[var(--text)] leading-relaxed mb-4 whitespace-pre-wrap"
          [innerHTML]="selectedNote.content || 'No content available'"
        ></div>

        <div class="text-sm text-[var(--text-secondary)] border-t border-[var(--border)] pt-3 space-y-1">
          <p><span class="font-medium text-[var(--accent)]">Author:</span> {{ selectedNote.authorname || 'N/A' }}</p>
          <p><span class="font-medium text-[var(--accent)]">Created:</span> {{ selectedNote.createdat | date:'medium' }}</p>
        </div>

      </div>

    </div>

    <!-- Loading Template -->
    <ng-template #loadingNote>
      <div class="text-center text-[var(--text-secondary)] text-lg mt-6">
        Loading note details...
      </div>
    </ng-template>

  </div>
</div>

  <div
  *ngIf="openEditPopup"
  class="fixed inset-0 bg-[var(--overlay)] flex justify-center items-center z-50"
>
  <div
    class="p-8 rounded-2xl shadow-2xl w-full max-w-3xl relative
           bg-[var(--card-bg)] border border-[var(--border)]"
  >

    <!-- Close Button -->
    <button
      (click)="closeEditPopup()"
      class="absolute top-4 right-5 text-[var(--text-secondary)]
             hover:text-[var(--accent)] text-2xl font-bold transition"
    >
      ‚úñ
    </button>

    <h2 class="text-2xl font-semibold mb-6 text-[var(--accent)] text-center drop-shadow-md">
      üìù Edit Note
    </h2>

    <div class="space-y-6">

      <!-- Title -->
      <div>
        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">
          Note Title *
        </label>
        <input
          type="text"
          [(ngModel)]="noteTitle"
          placeholder="Enter your note title..."
          class="w-full p-3 rounded-lg border
                 bg-[var(--input-bg)] text-[var(--text)]
                 border-[var(--border)]
                 focus:outline-none focus:ring-2 focus:ring-[var(--accent)]
                 placeholder-[var(--text-muted)] shadow-inner"
        />
      </div>

      <!-- Rich Text Editor -->
      <div>
        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2">
          Note Content *
        </label>

        <!-- Toolbar -->
        <div
          class="flex flex-wrap items-center justify-center gap-3 mb-3 p-3 rounded-lg border shadow-inner
                 bg-[var(--input-bg)] border-[var(--border)]"
        >
          <button
            type="button"
            (click)="formatText('bold')"
            title="Bold"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg font-bold"
          >B</button>

          <button
            type="button"
            (click)="formatText('italic')"
            title="Italic"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded italic text-lg"
          >I</button>

          <button
            type="button"
            (click)="formatText('underline')"
            title="Underline"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded underline text-lg"
          >U</button>

          <button
            type="button"
            (click)="formatText('strikeThrough')"
            title="Strikethrough"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg line-through"
          >S</button>

          <div class="w-px h-5 bg-[var(--border)]"></div>

          <button
            type="button"
            (click)="formatText('insertUnorderedList')"
            title="Bullet List"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg"
          >‚Ä¢ List</button>

          <button
            type="button"
            (click)="formatText('insertOrderedList')"
            title="Numbered List"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg"
          >1. List</button>

          <div class="w-px h-5 bg-[var(--border)]"></div>

          <button
            type="button"
            (click)="formatText('justifyLeft')"
            title="Align Left"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg"
          >‚á§</button>

          <button
            type="button"
            (click)="formatText('justifyCenter')"
            title="Align Center"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg"
          >‚ò∞</button>

          <button
            type="button"
            (click)="formatText('justifyRight')"
            title="Align Right"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg"
          >‚á•</button>

          <div class="w-px h-5 bg-[var(--border)]"></div>

          <button
            type="button"
            (click)="formatText('undo')"
            title="Undo"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg"
          >‚Ü∂</button>
          <button
            type="button"
            (click)="formatText('redo')"
            title="Redo"
            class="px-2 py-1 text-[var(--accent)] hover:bg-[var(--accent-hover)]/20 rounded text-lg"
          >‚Ü∑</button>
        </div>

        <!-- Editor Area -->
        <div
          #editor
          id="editNoteEditor"
          contenteditable="true"
          dir="ltr"
          spellcheck="true"
          (input)="onEditNoteInput($event)"
          class="w-full min-h-[250px] p-4 rounded-lg shadow-inner overflow-y-auto text-left
                 bg-[var(--input-bg)] text-[var(--text)]
                 border border-[var(--border)]
                 focus:outline-none focus:ring-2 focus:ring-[var(--accent)]"
        ></div>
      </div>

      <!-- Flags -->
      <div class="flex items-center justify-center space-x-8 mt-4">
        <label class="flex items-center space-x-2 text-sm text-[var(--text-secondary)]">
          <input
            type="checkbox"
            [(ngModel)]="notePinned"
            class="h-5 w-5 rounded border-[var(--border)]
                   bg-[var(--input-bg)] text-[var(--accent)] focus:ring-[var(--accent)] focus:ring-2"
          />
          <span>Pinned</span>
        </label>

        <label class="flex items-center space-x-2 text-sm text-[var(--text-secondary)]">
          <input
            type="checkbox"
            [(ngModel)]="noteArchived"
            class="h-5 w-5 rounded border-[var(--border)]
                   bg-[var(--input-bg)] text-[var(--accent)] focus:ring-[var(--accent)] focus:ring-2"
          />
          <span>Archived</span>
        </label>
      </div>

      <!-- Save Button -->
      <button
        (click)="EditaddNote()"
        class="w-full py-3 px-4 rounded-lg font-semibold shadow-md text-lg
               bg-[var(--accent)] text-[var(--button-text)]
               hover:bg-[var(--accent-hover)] transition-all"
      >
        üíæ Save Note
      </button>

    </div>
  </div>
</div>


  <!-- Inline confirmation popup -->
  <!-- Overlay -->
  <div
  *ngIf="deleteNoteId !== 0"
  class="fixed inset-0 bg-black/70 flex items-center justify-center z-50"
>
  <!-- Modal -->
  <div
    class="bg-white dark:bg-slate-900 text-black dark:text-white 
           p-6 rounded-2xl shadow-2xl w-[320px] border 
           border-gray-300 dark:border-slate-700 transition-all"
  >
    <h3 class="text-xl font-semibold mb-3 text-center text-red-600 dark:text-red-400">
      ‚ö†Ô∏è Confirm Delete
    </h3>

    <p class="mb-5 text-center text-gray-700 dark:text-gray-300">
      Are you sure you want to delete this note?
    </p>

    <div class="flex justify-center gap-4">
      <!-- DELETE button -->
      <button
        (click)="confirmDelete(true)"
        class="px-4 py-2 rounded-lg font-semibold
               bg-red-600 hover:bg-red-700 
               text-white shadow-md transition-all"
      >
        Yes, Delete
      </button>

      <!-- CANCEL button -->
      <button
        (click)="confirmDelete(false)"
        class="px-4 py-2 rounded-lg font-semibold
               bg-gray-300 hover:bg-gray-400 text-black
               dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-white
               shadow-md transition-all"
      >
        Cancel
      </button>
    </div>
  </div>
</div>


</div>