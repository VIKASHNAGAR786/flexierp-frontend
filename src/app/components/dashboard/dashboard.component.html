<!-- dashboard.component.html -->
<div
  class="min-h-screen font-sans p-6"
  [ngStyle]="{
      'background': 'linear-gradient(to bottom, var(--bg-start), var(--bg-mid), var(--bg-end))',
      'color': 'var(--text)'
     }"
  >

  <!-- Header -->
  <div class="mb-6">
    <h1
      class="text-3xl font-bold"
      [style.color]="'var(--heading)'"
      >
      Finance Dashboard
    </h1>
    <p
      class="text-sm"
      [style.color]="'var(--text-muted)'"
      >
      Overview of your cash & cheque transactions
    </p>
  </div>

  <!-- Filters -->
  <div class="flex flex-wrap gap-4 mb-6">
    <div>
      <label
        class="block mb-1"
        [style.color]="'var(--text-muted)'"
      >Date Range</label>

      <select
        class="rounded px-3 py-2"
        [ngStyle]="{
            'background': 'var(--card)',
            'border': '1px solid var(--border)',
            'color': 'var(--text)'
          }"
        [(ngModel)]="selectedRange"
        (change)="onDateRangeChange()"
        >

        <option value="today">Today</option>
        <option value="yesterday">Yesterday</option>

        <option value="7">Last 7 Days</option>
        <option value="30">Last Month</option>
        <option value="365">Last Year</option>

      </select>
    </div>


    <button
      (click)="exportToPdf()"
      class="px-4 py-2 rounded font-semibold transition"
      [ngStyle]="{
        'background':'var(--banner-start)',
        'color':'var(--text)'
      }"
      >
      Export PDF
    </button>

    <button
      (click)="exportToExcel()"
      class="px-4 py-2 rounded font-semibold transition"
      [ngStyle]="{
        'background':'var(--banner-end)',
        'color':'var(--text)'
      }"
      >
      Export Excel
    </button>
  </div>

  <!-- Metrics Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

    <!-- CASH CARD -->
    <div
      class="rounded-xl p-4 shadow-lg transition"
      [ngStyle]="{
           'background':'var(--card)',
           'border':'1px solid var(--border)'
         }"
      >
      <p
        class="uppercase text-sm"
        [style.color]="'var(--text-muted)'"
        >
        Total Cash Received
      </p>
      <h2
        class="text-2xl font-bold"
        [style.color]="'var(--heading)'"
        >
        â‚¹ {{ dashboarddata.totalCashReceived }}
      </h2>

      <p
        class="text-sm mt-1"
        [ngClass]="dashboarddata.cashGrowthPercent < 0
              ? 'text-red-400'
              : 'text-green-400'"
        >
        â‚¹ {{ dashboarddata.cashGrowthPercent }} From Last Month
      </p>
    </div>

    <!-- CHEQUE CARD -->
    <div
      class="rounded-xl p-4 shadow-lg transition"
      [ngStyle]="{
           'background':'var(--card)',
           'border':'1px solid var(--border)'
         }"
      >
      <p
        class="uppercase text-sm"
        [style.color]="'var(--text-muted)'"
        >
        Total Cheque Received
      </p>
      <h2 class="text-2xl font-bold text-purple-400">
        â‚¹ {{ dashboarddata.totalChequeReceived }}
      </h2>
      <p
        class="text-sm mt-1"
        [ngClass]="dashboarddata.chequeGrowthPercent < 0
              ? 'text-red-400'
              : 'text-green-400'"
        >
        â‚¹ {{ dashboarddata.chequeGrowthPercent }} From Last Month
      </p>
    </div>

    <!-- BALANCE DUE -->
    <div
      class="rounded-xl p-4 shadow-lg transition"
      [ngStyle]="{
           'background':'var(--card)',
           'border':'1px solid var(--border)'
         }"
      >
      <p
        class="uppercase text-sm"
        [style.color]="'var(--text-muted)'"
        >
        Total Balance Due
      </p>
      <h2 class="text-2xl font-bold text-yellow-400">
        â‚¹ {{ dashboarddata.totalBalanceDue }}
      </h2>
    </div>

    <!-- TRENDS CARD -->
    <div
      class="rounded-xl p-4 shadow-lg transition"
      [ngStyle]="{
           'background':'var(--card)',
           'border':'1px solid var(--border)'
         }"
      >
      <p
        class="uppercase text-sm"
        [style.color]="'var(--text-muted)'"
        >
        Trends & Growth
      </p>
      <h2 class="text-2xl font-bold text-pink-400">
        ðŸ“ˆ Increasing
      </h2>
    </div>

  </div>

  <!-- TABLE -->
  <div
    class="mt-8 rounded-xl p-4 shadow-lg"
    [ngStyle]="{
         'background':'var(--card)',
         'border':'1px solid var(--border)'
       }"
    >
    <div class="flex items-center justify-between mb-4">
      <h3
        class="text-xl font-semibold"
        [style.color]="'var(--heading)'"
        >
        Recent Transactions
        <span
          class="text-sm ml-2"
          [style.color]="'var(--text-muted)'"
          >
          (Last 50 Records)
        </span>
      </h3>
    </div>

    <table class="w-full text-left border-collapse">
      <thead>
        <tr [ngStyle]="{
              'color':'var(--text-muted)',
              'border-bottom':'1px solid var(--border)'
            }">
          <th class="py-2 px-4">Date</th>
          <th class="py-2 px-4">Customer</th>
          <th class="py-2 px-4">Received Amount</th>
          <th class="py-2 px-4">Balance Due</th>
          <th class="py-2 px-4">Total Amount</th>
          <th class="py-2 px-4">Payment Type</th>
          <th class="py-2 px-4">Transaction Type</th>
        </tr>
      </thead>
      <tbody>
        @for (transaction of dashboarddata.recenttransaction; track transaction) {
          <tr
            class="transition"
          [ngStyle]="{
              'border-bottom':'1px solid var(--border)'
            }"
            [ngClass]="'hover:bg-[var(--hover-bg)]'"
            >
            <td class="py-2 px-4">{{ transaction.date }}</td>
            <td class="py-2 px-4">{{ transaction.customerName }}</td>
            <td class="py-2 px-4">â‚¹ {{ transaction.receivedAmount | number:'1.0-2' }}</td>
            <td class="py-2 px-4">â‚¹ {{ transaction.balanceDue | number:'1.0-2' }}</td>
            <td class="py-2 px-4">â‚¹ {{ transaction.totalAmount | number:'1.0-2' }}</td>
            <td
              class="py-2 px-4"
            [ngClass]="{
                'text-green-500 font-bold border-l-4 border-green-500': transaction.paymentType === 'Cash',
                'text-blue-500 font-bold border-l-4 border-blue-500': transaction.paymentType === 'Cheque'
              }"
              >
              {{ transaction.paymentType }}
            </td>
            <td class="py-2 px-4">{{ transaction.transactionType }}</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!-- loader -->

<!-- for the big loader -->
@if (reportIsLoading) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm"
    >
    <div class="text-center space-y-4">
      <!-- Animated FLEXIERP text -->
      <h1 class="text-5xl font-extrabold text-[#00ffee] animate-bounce">FLEXIERP</h1>
      <!-- Bouncing dots -->
      <div class="flex justify-center space-x-2">
        <span class="w-4 h-4 bg-[#00ffee] rounded-full animate-bounce delay-100"></span>
        <span class="w-4 h-4 bg-[#00ffee] rounded-full animate-bounce delay-200"></span>
        <span class="w-4 h-4 bg-[#00ffee] rounded-full animate-bounce delay-300"></span>
      </div>
      <p class="text-white text-lg font-semibold animate-pulse">Loading report, please wait...</p>
    </div>
  </div>
}